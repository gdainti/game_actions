var Api={call:function(t,n,s,e){var e=e||function(){},t=t||"GET",s=s||"",o=new XMLHttpRequest;o.open(t,n),o.onload=function(){if(200!==o.status)throw new Error("Неверный запрос, status="+o.status);e(JSON.parse(o.responseText))},o.send(s)}};
var App=function(){"use strict";var t={actions:[],currentPoints:0,appendHtml:function(t,i){var n=document.createElement("div");for(n.innerHTML=i;n.children.length>0;)t.appendChild(n.children[0])},formatTime:function(t){Number.prototype.pad=function(t){for(var i=String(this);i.length<(t||2);)i="0"+i;return i};var i=Math.floor(t/60),n=t-60*i;return i.pad()+":"+n.pad()},setTime:function(t,i){var n=t.getElementsByClassName("js-action-time");n[0].innerHTML=this.formatTime(i)},showAction:function(t){var i=['<div id="js-action-{id}" title="{title}" class="js-action-click action action--{id}" data-id="{id}" onclick="App.actionClick(this)">','<div class="action__image"></div>','<div class="js-action-time action__time"></div>',"</div>"].join("");i=i.replace(/{[^{}]+}/g,function(i){return t[i.replace(/[{}]+/g,"")]||""}),this.appendHtml(document.getElementById("js-actions"),i)},getActionById:function(i){for(var n=0;n<t.actions.length;n++)if(t.actions[n].id==i)return t.actions[n];return!1},updatePoints:function(i){t.currentPoints=i;var n=document.getElementById("js-current-points");n.innerHTML=i},actionClick:function(i){var n=i.getAttribute("data-id"),e=t.getActionById(n);e.active===!0&&t.makeAction(i,e)},makeAction:function(i,n){var e=t.currentPoints+n.points;Api.call("POST","api/index.php","actionId="+n.id,function(){t.updatePoints(e),t.disableAction(i,n)})},disableAction:function(i,n){n.active=!1,Class.addClass(i,"action--inactive"),t.setTime(i,n.recovery_time);var e=n.recovery_time,c=setInterval(function(){e>1?(e--,t.setTime(i,e)):(t.enableAction(i,n),clearTimeout(c))},1e3)},enableAction:function(t,i){i.active=!0,Class.removeClass(t,"action--inactive")},init:function(){Api.call("GET","api/index.php",{},function(i){if("ok"==i.status&&i.current_points&&i.actions){t.actions=i.actions,t.updatePoints(i.current_points);for(var n=0;n<t.actions.length;n++)t.actions[n].active=!0,t.showAction(t.actions[n])}})}};return t.init(),{actionClick:t.actionClick}}();
var Class=function(){return{hasClass:function(s,a){return!!s.className.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))},addClass:function(s,a){this.hasClass(s,a)||(s.className+=" "+a)},removeClass:function(s,a){if(this.hasClass(s,a)){var e=new RegExp("(\\s|^)"+a+"(\\s|$)");s.className=s.className.replace(e," ")}}}}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwaS5qcyIsImFwcC5qcyIsImNsYXNzLmpzIl0sIm5hbWVzIjpbIkFwaSIsImNhbGwiLCJtZXRob2QiLCJ1cmwiLCJkYXRhIiwiY2FsbGJhY2siLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWQiLCJzdGF0dXMiLCJFcnJvciIsIkpTT04iLCJwYXJzZSIsInJlc3BvbnNlVGV4dCIsInNlbmQiLCJBcHAiLCJBY3Rpb25zIiwiYWN0aW9ucyIsImN1cnJlbnRQb2ludHMiLCJhcHBlbmRIdG1sIiwiZWwiLCJzdHIiLCJkaXYiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJjaGlsZHJlbiIsImxlbmd0aCIsImFwcGVuZENoaWxkIiwiZm9ybWF0VGltZSIsInRvdGFsIiwiTnVtYmVyIiwicHJvdG90eXBlIiwicGFkIiwic2l6ZSIsInMiLCJTdHJpbmciLCJ0aGlzIiwibWludXRlIiwiTWF0aCIsImZsb29yIiwic2Vjb25kcyIsInNldFRpbWUiLCJhY3Rpb25FbGVtZW50IiwidGltZSIsInRpbWVFbGVtZW50IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsInNob3dBY3Rpb24iLCJhY3Rpb24iLCJ0ZW1wbGF0ZSIsImpvaW4iLCJyZXBsYWNlIiwia2V5IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRBY3Rpb25CeUlkIiwiYWN0aW9uSWQiLCJpIiwiaWQiLCJ1cGRhdGVQb2ludHMiLCJwb2ludHMiLCJwb2ludEVsZW1lbnQiLCJhY3Rpb25DbGljayIsImdldEF0dHJpYnV0ZSIsImFjdGl2ZSIsIm1ha2VBY3Rpb24iLCJkaXNhYmxlQWN0aW9uIiwiQ2xhc3MiLCJhZGRDbGFzcyIsInJlY292ZXJ5X3RpbWUiLCJ0aW1lTGVmdCIsInRpbWVvdXQiLCJzZXRJbnRlcnZhbCIsImVuYWJsZUFjdGlvbiIsImNsZWFyVGltZW91dCIsInJlbW92ZUNsYXNzIiwiaW5pdCIsImN1cnJlbnRfcG9pbnRzIiwiaGFzQ2xhc3MiLCJlbGUiLCJj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QVMsRUFDaEJHLE1BQU1RLFlBQVkvQixFQUFlLHFCQUdyQ2dDLEtBQU0sV0FDRjVFLElBQUlDLEtBQUssTUFBTyxtQkFBcUIsU0FBU0csR0FDMUMsR0FBbUIsTUFBZkEsRUFBS00sUUFBa0JOLEVBQUt5RSxnQkFBa0J6RSxFQUFLYyxRQUFTLENBQzVERCxFQUFRQyxRQUFVZCxFQUFLYyxRQUN2QkQsRUFBUTBDLGFBQWF2RCxFQUFLeUUsZUFFMUIsS0FBSyxHQUFJcEIsR0FBSSxFQUFHQSxFQUFJeEMsRUFBUUMsUUFBUVUsT0FBUTZCLElBQ3hDeEMsRUFBUUMsUUFBUXVDLEdBQUdPLFFBQVMsRUFDNUIvQyxFQUFRK0IsV0FBVy9CLEVBQVFDLFFBQVF1QyxRQVN2RCxPQUZBeEMsR0FBUTJELFFBR0pkLFlBQWE3QyxFQUFRNkM7QUM5SDdCLEdBQUlLLE9BQVEsV0FFUixPQUVJVyxTQUFVLFNBQVVDLEVBQUlDLEdBQ3BCLFFBQVNELEVBQUlFLFVBQVVDLE1BQU0sR0FBSUMsUUFBTyxVQUFVSCxFQUFJLGFBRzFEWixTQUFVLFNBQVNXLEVBQUlDLEdBQ2QxQyxLQUFLd0MsU0FBU0MsRUFBSUMsS0FBTUQsRUFBSUUsV0FBYSxJQUFJRCxJQUd0REwsWUFBYSxTQUFTSSxFQUFJQyxHQUN0QixHQUFJMUMsS0FBS3dDLFNBQVNDLEVBQUlDLEdBQU0sQ0FDeEIsR0FBSUksR0FBTSxHQUFJRCxRQUFPLFVBQVVILEVBQUksVUFDbkNELEdBQUlFLFVBQVVGLEVBQUlFLFVBQVU3QixRQUFRZ0MsRUFBSSIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgQXBpID0ge1xyXG5cclxuICAgIGNhbGw6IGZ1bmN0aW9uKG1ldGhvZCwgdXJsLCBkYXRhLCBjYWxsYmFjaykge1xyXG5cclxuICAgICAgICB2YXIgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9O1xyXG4gICAgICAgIHZhciBtZXRob2QgPSBtZXRob2QgfHwgJ0dFVCc7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBkYXRhIHx8ICcnO1xyXG5cclxuICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICAgICAgeGhyLm9wZW4obWV0aG9kLCB1cmwpO1xyXG4gICAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ9Cd0LXQstC10YDQvdGL0Lkg0LfQsNC/0YDQvtGBLCBzdGF0dXM9JyArIHhoci5zdGF0dXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgeGhyLnNlbmQoZGF0YSk7XHJcbiAgICB9XHJcbn07IiwidmFyIEFwcCA9IChmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgQWN0aW9ucyA9IHtcclxuXHJcbiAgICAgICAgYWN0aW9uczogW10sXHJcbiAgICAgICAgY3VycmVudFBvaW50czogMCxcclxuXHJcbiAgICAgICAgYXBwZW5kSHRtbDogZnVuY3Rpb24oZWwsIHN0cikge1xyXG4gICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBzdHI7XHJcbiAgICAgICAgICAgIHdoaWxlIChkaXYuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoZGl2LmNoaWxkcmVuWzBdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGZvcm1hdFRpbWU6IGZ1bmN0aW9uKHRvdGFsKSB7XHJcblxyXG4gICAgICAgICAgICBOdW1iZXIucHJvdG90eXBlLnBhZCA9IGZ1bmN0aW9uKHNpemUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzID0gU3RyaW5nKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHMubGVuZ3RoIDwgKHNpemUgfHwgMikpIHtzID0gXCIwXCIgKyBzO31cclxuICAgICAgICAgICAgICAgIHJldHVybiBzO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIG1pbnV0ZSA9IE1hdGguZmxvb3IodG90YWwvNjApO1xyXG4gICAgICAgICAgICB2YXIgc2Vjb25kcyA9IHRvdGFsIC0gKG1pbnV0ZSo2MCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbWludXRlLnBhZCgpICsgJzonICsgc2Vjb25kcy5wYWQoKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzZXRUaW1lOiBmdW5jdGlvbihhY3Rpb25FbGVtZW50LCB0aW1lKSB7XHJcbiAgICAgICAgICAgIHZhciB0aW1lRWxlbWVudCA9IGFjdGlvbkVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnanMtYWN0aW9uLXRpbWUnKTtcclxuICAgICAgICAgICAgdGltZUVsZW1lbnRbMF0uaW5uZXJIVE1MID0gdGhpcy5mb3JtYXRUaW1lKHRpbWUpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNob3dBY3Rpb246IGZ1bmN0aW9uKGFjdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBbXHJcbiAgICAgICAgICAgICAgICAnPGRpdiBpZD1cImpzLWFjdGlvbi17aWR9XCIgdGl0bGU9XCJ7dGl0bGV9XCIgY2xhc3M9XCJqcy1hY3Rpb24tY2xpY2sgYWN0aW9uIGFjdGlvbi0te2lkfVwiIGRhdGEtaWQ9XCJ7aWR9XCIgb25jbGljaz1cIkFwcC5hY3Rpb25DbGljayh0aGlzKVwiPicsXHJcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJhY3Rpb25fX2ltYWdlXCI+PC9kaXY+JyxcclxuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImpzLWFjdGlvbi10aW1lIGFjdGlvbl9fdGltZVwiPjwvZGl2PicsXHJcbiAgICAgICAgICAgICAgICAnPC9kaXY+J1xyXG4gICAgICAgICAgICBdLmpvaW4oJycpO1xyXG5cclxuICAgICAgICAgICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKC97W157fV0rfS9nLCBmdW5jdGlvbihrZXkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25ba2V5LnJlcGxhY2UoL1t7fV0rL2csIFwiXCIpXSB8fCBcIlwiO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYXBwZW5kSHRtbChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanMtYWN0aW9ucycpLCB0ZW1wbGF0ZSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZ2V0QWN0aW9uQnlJZDogZnVuY3Rpb24oYWN0aW9uSWQpIHtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQWN0aW9ucy5hY3Rpb25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQWN0aW9ucy5hY3Rpb25zW2ldLmlkID09IGFjdGlvbklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEFjdGlvbnMuYWN0aW9uc1tpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdXBkYXRlUG9pbnRzOiBmdW5jdGlvbihwb2ludHMpIHtcclxuICAgICAgICAgICAgQWN0aW9ucy5jdXJyZW50UG9pbnRzID0gcG9pbnRzO1xyXG4gICAgICAgICAgICB2YXIgcG9pbnRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzLWN1cnJlbnQtcG9pbnRzJyk7XHJcbiAgICAgICAgICAgIHBvaW50RWxlbWVudC5pbm5lckhUTUwgPSBwb2ludHM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgYWN0aW9uQ2xpY2s6IGZ1bmN0aW9uKGFjdGlvbkVsZW1lbnQpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBhY3Rpb25JZCA9IGFjdGlvbkVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBBY3Rpb25zLmdldEFjdGlvbkJ5SWQoYWN0aW9uSWQpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGFjdGlvbi5hY3RpdmUgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIEFjdGlvbnMubWFrZUFjdGlvbihhY3Rpb25FbGVtZW50LCBhY3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgbWFrZUFjdGlvbjogZnVuY3Rpb24oYWN0aW9uRWxlbWVudCwgYWN0aW9uKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgcG9pbnRzID0gQWN0aW9ucy5jdXJyZW50UG9pbnRzICsgYWN0aW9uLnBvaW50cztcclxuICAgICAgICAgICAgQXBpLmNhbGwoJ1BPU1QnLCdhcGkvaW5kZXgucGhwJywgJ2FjdGlvbklkPScrYWN0aW9uLmlkLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIEFjdGlvbnMudXBkYXRlUG9pbnRzKHBvaW50cyk7XHJcbiAgICAgICAgICAgICAgICBBY3Rpb25zLmRpc2FibGVBY3Rpb24oYWN0aW9uRWxlbWVudCwgYWN0aW9uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZGlzYWJsZUFjdGlvbjogZnVuY3Rpb24oYWN0aW9uRWxlbWVudCwgYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGFjdGlvbi5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgQ2xhc3MuYWRkQ2xhc3MoYWN0aW9uRWxlbWVudCwgJ2FjdGlvbi0taW5hY3RpdmUnKTtcclxuICAgICAgICAgICAgQWN0aW9ucy5zZXRUaW1lKGFjdGlvbkVsZW1lbnQsIGFjdGlvbi5yZWNvdmVyeV90aW1lKTtcclxuXHJcbiAgICAgICAgICAgIHZhciB0aW1lTGVmdCA9IGFjdGlvbi5yZWNvdmVyeV90aW1lO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGltZUxlZnQgPiAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGltZUxlZnQtLTtcclxuICAgICAgICAgICAgICAgICAgICBBY3Rpb25zLnNldFRpbWUoYWN0aW9uRWxlbWVudCwgdGltZUxlZnQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBBY3Rpb25zLmVuYWJsZUFjdGlvbihhY3Rpb25FbGVtZW50LCBhY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZW5hYmxlQWN0aW9uOiBmdW5jdGlvbihhY3Rpb25FbGVtZW50LCBhY3Rpb24pIHtcclxuICAgICAgICAgICAgYWN0aW9uLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIENsYXNzLnJlbW92ZUNsYXNzKGFjdGlvbkVsZW1lbnQsICdhY3Rpb24tLWluYWN0aXZlJyk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIEFwaS5jYWxsKCdHRVQnLCAnYXBpL2luZGV4LnBocCcsIHt9LCBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT0gJ29rJyAmJiBkYXRhLmN1cnJlbnRfcG9pbnRzICYmIGRhdGEuYWN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIEFjdGlvbnMuYWN0aW9ucyA9IGRhdGEuYWN0aW9ucztcclxuICAgICAgICAgICAgICAgICAgICBBY3Rpb25zLnVwZGF0ZVBvaW50cyhkYXRhLmN1cnJlbnRfcG9pbnRzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBBY3Rpb25zLmFjdGlvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9ucy5hY3Rpb25zW2ldLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFjdGlvbnMuc2hvd0FjdGlvbihBY3Rpb25zLmFjdGlvbnNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBBY3Rpb25zLmluaXQoKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGFjdGlvbkNsaWNrOiBBY3Rpb25zLmFjdGlvbkNsaWNrXHJcbiAgICB9XHJcblxyXG59KSgpOyIsInZhciBDbGFzcyA9IChmdW5jdGlvbigpIHtcclxuXHJcbiAgICByZXR1cm4ge1xyXG5cclxuICAgICAgICBoYXNDbGFzczogZnVuY3Rpb24gKGVsZSxjbHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuICEhZWxlLmNsYXNzTmFtZS5tYXRjaChuZXcgUmVnRXhwKCcoXFxcXHN8XiknK2NscysnKFxcXFxzfCQpJykpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGFkZENsYXNzOiBmdW5jdGlvbihlbGUsY2xzKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5oYXNDbGFzcyhlbGUsY2xzKSkgZWxlLmNsYXNzTmFtZSArPSBcIiBcIitjbHM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKGVsZSxjbHMpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaGFzQ2xhc3MoZWxlLGNscykpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKCcoXFxcXHN8XiknK2NscysnKFxcXFxzfCQpJyk7XHJcbiAgICAgICAgICAgICAgICBlbGUuY2xhc3NOYW1lPWVsZS5jbGFzc05hbWUucmVwbGFjZShyZWcsJyAnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTtcclxuXHJcblxyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
